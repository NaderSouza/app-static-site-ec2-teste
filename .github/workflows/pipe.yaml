name: Pipeline do CP-01

on:
  push:
    branches:
    - develop

jobs:

  acceptance:
    name: Terraform Acceptance Tests
    runs-on: ubuntu-latest

    steps:

      - name: Step 01 - CheckOut GitHub Repo
        uses: actions/checkout@v3

      - name: Step 02 - Setup GO
        uses: actions/setup-go@v4
        with:
          go-version-file: 'go.mod'

      - name: Step 03 - Terraform Setup
        uses: hashicorp/setup-terraform@v2
        with:
          terraform_version: 1.5.6
          terraform_wrapper: false

      - name: Step 04 - Terraform Acceptance Test
        run: go test -v -cover ./...
        env:
          TF_ACC: '1'

  # unit:
  #   name: Terraform Unit Tests
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v3
  #     - uses: actions/setup-go@v4
  #       with:
  #         go-version-file: 'go.mod'
  #     - run: go test -v -cover ./...

  # apply:
  #   name: Terraform apply
  #   runs-on: ubuntu-latest
 
  #   steps:

  #   - name: Step 01 - Terraform Setup
  #     uses: hashicorp/setup-terraform@v2
  #     with:
  #       terraform_version: 1.5.6

  #   - name: Step 02 - Terraform Version
  #     run : terraform --version

  #   - name: Step 03 - CheckOut GitHub Repo
  #     uses: actions/checkout@v3

  #   - name: Step 04 - Set AWS Account
  #     uses: aws-actions/configure-aws-credentials@v2
  #     with:
  #       aws-access-key-id    : ${{ secrets.AWS_ACCESS_KEY_ID }}
  #       aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  #       aws-session-token    : ${{ secrets.AWS_SESSION_TOKEN }}
  #       aws-region           : us-east-1

  #   - name: Step 05 - Terraform Init
  #     run : terraform -chdir=./terraform init -input=false

  #   - name: Step 06 - Terraform Unit Tests
  #     run : terraform -chdir=./terraform validate

  #   - name: Step 07 - Terraform Plan with Contract Tests
  #     run : terraform -chdir=./terraform plan -input=false -out tfplan
  #     # run : terraform -chdir=./terraform plan -input=false -destroy -out tfplan

  #   - name: Step 08 - Terraform Apply
  #     run : terraform -chdir=./terraform apply -auto-approve -input=false tfplan

  #   - name: Step 09 - Terraform Show
  #     run : terraform -chdir=./terraform show
      